"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7390],{7390:(x,h,r)=>{r.r(h),r.d(h,{ChatRoomModule:()=>w});var l=r(177),d=r(4341),i=r(4742),u=r(9166),m=r(467),C=r(8455),n=r(4438),M=r(2128),p=r(1740),O=r(4374);const _=["messageInput"],P=o=>({"own-message":o});function f(o,g){if(1&o&&(n.j41(0,"div",16)(1,"div",17)(2,"p"),n.EFF(3),n.k0s(),n.j41(4,"small",18),n.EFF(5),n.nI1(6,"date"),n.k0s()()()),2&o){const a=g.$implicit,e=n.XpG();n.Y8G("ngClass",n.eq3(6,P,a.senderId===e.currentUserId)),n.R7$(3),n.JRh(a.content),n.R7$(2),n.JRh(n.i5U(6,3,a.timestamp,"short"))}}function b(o,g){if(1&o&&(n.j41(0,"div",19),n.EFF(1),n.k0s()),2&o){const a=n.XpG();n.R7$(),n.SpI(" ",a.newMessage.length,"/1000 ")}}const v=[{path:"",component:(()=>{var o;class g{constructor(e,t,s,c,k){this.route=e,this.chatService=t,this.authService=s,this.location=c,this.darkModeService=k,this.darkModeEnabled=!1,this.messages=[],this.newMessage="",this.maxMessageLength=1e3,this.currentUserId=null,this.subscriptions=[]}ngOnInit(){this.darkModeService.getDarkModeStatus().subscribe(e=>{this.darkModeEnabled=e}),this.chatId=this.route.snapshot.paramMap.get("id"),this.loadMessages(),this.loadOtherUser(),this.subscriptions.push((0,C.H)(this.authService.getCurrentUserId()).subscribe(e=>{this.currentUserId=e,e&&this.chatService.updateUserStatus(e,!0),console.log("Current user ID:",this.currentUserId)}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}goBack(){this.location.back()}loadMessages(){this.subscriptions.push(this.chatService.getMessages(this.chatId).subscribe(e=>{this.messages=e.map(t=>{var s;return{...t,timestamp:null===(s=t.timestamp)||void 0===s?void 0:s.toDate()}}),this.scrollToBottom()},e=>{console.error("Error loading messages:",e)}))}loadOtherUser(){this.subscriptions.push(this.chatService.getOtherUser(this.chatId).subscribe(e=>{this.otherUser=e,console.log(this.otherUser)},e=>{console.error("Error loading other user:",e)}))}sendMessage(){var e=this;return(0,m.A)(function*(){var t;if(null!==(t=e.newMessage)&&void 0!==t&&t.trim()){const s=e.newMessage.trim();e.newMessage="";try{yield e.chatService.sendMessage(e.chatId,s).toPromise(),(yield e.messageInput.getInputElement()).style.height="auto",e.scrollToBottom()}catch(c){console.error("Error sending message:",c)}}})()}onInputChange(e){var t=this;return(0,m.A)(function*(){const s=yield t.messageInput.getInputElement();s.style.height="auto",s.style.height=s.scrollHeight+"px",t.newMessage.length>t.maxMessageLength&&(t.newMessage=t.newMessage.substring(0,t.maxMessageLength)),t.scrollToBottom()})()}scrollToBottom(e=300){setTimeout(()=>{var t;null===(t=this.content)||void 0===t||t.scrollToBottom(e)},100)}ionViewDidEnter(){var e=this;return(0,m.A)(function*(){e.scrollToBottom(0),setTimeout(()=>{var t;null===(t=e.messageInput)||void 0===t||t.setFocus()},500)})()}handleKeyPress(e){var t=this;return(0,m.A)(function*(){"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),yield t.sendMessage())})()}getUserLabel(e){var t;return e===this.currentUserId?"You":(null===(t=this.otherUser)||void 0===t?void 0:t.name)||"User"}}return(o=g).\u0275fac=function(e){return new(e||o)(n.rXU(u.nX),n.rXU(M.m),n.rXU(p.k),n.rXU(l.aZ),n.rXU(O.B))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-chat-room"]],viewQuery:function(e,t){if(1&e&&(n.GBs(i.W9,5),n.GBs(_,5)),2&e){let s;n.mGM(s=n.lsd())&&(t.content=s.first),n.mGM(s=n.lsd())&&(t.messageInput=s.first)}},decls:23,vars:9,consts:[[1,"ion-no-border"],["slot","start"],[3,"click"],["name","arrow-back"],[1,"user-info"],[3,"src"],[1,"user-details"],[1,"user-name"],[1,"user-status"],["scrollEvents","true"],[1,"message-list"],["class","message-item",3,"ngClass",4,"ngFor","ngForOf"],["placeholder","Type a message...",3,"ngModelChange","keyup.enter","ngModel"],["slot","end",3,"click","disabled"],["name","send"],["class","text-counter",4,"ngIf"],[1,"message-item",3,"ngClass"],[1,"message-content"],[1,"timestamp"],[1,"text-counter"]],template:function(e,t){1&e&&(n.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),n.bIt("click",function(){return t.goBack()}),n.nrm(4,"ion-icon",3),n.k0s()(),n.j41(5,"div",4)(6,"ion-avatar",1),n.nrm(7,"img",5),n.k0s(),n.j41(8,"div",6)(9,"ion-label",7),n.EFF(10),n.k0s(),n.j41(11,"ion-label",8),n.EFF(12),n.k0s()()()()(),n.j41(13,"ion-content",9)(14,"div",10),n.DNE(15,f,7,8,"div",11),n.k0s()(),n.j41(16,"ion-footer")(17,"ion-toolbar")(18,"ion-item")(19,"ion-input",12),n.mxI("ngModelChange",function(c){return n.DH7(t.newMessage,c)||(t.newMessage=c),c}),n.bIt("keyup.enter",function(){return t.sendMessage()}),n.k0s(),n.j41(20,"ion-button",13),n.bIt("click",function(){return t.sendMessage()}),n.nrm(21,"ion-icon",14),n.k0s()(),n.DNE(22,b,2,1,"div",15),n.k0s()()),2&e&&(n.R7$(7),n.Y8G("src",(null==t.otherUser?null:t.otherUser.profilePictureUrl)||"./assets/profile-placeholder.jpg",n.B4B),n.R7$(3),n.JRh((null==t.otherUser?null:t.otherUser.fullName)||"User"),n.R7$(),n.AVh("online",null==t.otherUser?null:t.otherUser.isOnline),n.R7$(),n.SpI(" ",null!=t.otherUser&&t.otherUser.isOnline?"Active Now":"Offline"," "),n.R7$(3),n.Y8G("ngForOf",t.messages),n.R7$(4),n.R50("ngModel",t.newMessage),n.R7$(),n.Y8G("disabled",!t.newMessage.trim()),n.R7$(2),n.Y8G("ngIf",null==t.newMessage?null:t.newMessage.length))},dependencies:[l.YU,l.Sq,l.bT,d.BC,d.vS,i.mC,i.Jm,i.QW,i.W9,i.M0,i.eU,i.iq,i.$w,i.uz,i.he,i.ai,i.Gw,l.vh],styles:['[_nghost-%COMP%]{--message-bg-color: #e9ecef;--own-message-bg-color: #900;--message-text-color: #343a40;--own-message-text-color: #ffffff;--timestamp-color: #6c757d;--border-radius: 18px;--avatar-size: 40px;--max-message-width: 75%;--input-max-height: 100px}body.dark   [_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: oklch(27.8% .033 256.848)}body.dark   [_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{color:#fff}body.dark   [_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: oklch(21% .034 264.665)}body.dark   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]{background:#1e2939}body.dark   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{color:#fff}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: #ffffff;--border-width: 0;--min-height: 60px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 16px}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:var(--avatar-size);height:var(--avatar-size);margin-right:12px;flex-shrink:0}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:0}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-name[_ngcontent-%COMP%]{font-weight:600;font-size:16px;color:#000;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-status[_ngcontent-%COMP%]{font-size:12px;color:var(--timestamp-color)}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-status.online[_ngcontent-%COMP%]{color:#28a745}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .user-details[_ngcontent-%COMP%]   .user-status.online[_ngcontent-%COMP%]:before{content:"";display:inline-block;width:8px;height:8px;background-color:currentColor;border-radius:50%;margin-right:4px;vertical-align:middle}ion-content[_ngcontent-%COMP%]{--background: #f8f9fa}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;gap:8px}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]{display:flex;max-width:var(--max-message-width)}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{padding:12px 16px;background:var(--message-bg-color);border-radius:var(--border-radius);position:relative;word-wrap:break-word;white-space:pre-wrap}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--message-text-color);font-size:14px;line-height:1.4;overflow-wrap:break-word;word-break:break-word;-webkit-hyphens:auto;hyphens:auto;max-width:100%}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{display:block;font-size:11px;color:var(--timestamp-color);margin-top:4px;white-space:nowrap}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item.own-message[_ngcontent-%COMP%]{margin-left:auto}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item.own-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:var(--own-message-bg-color)}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item.own-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--own-message-text-color)}ion-content[_ngcontent-%COMP%]   .message-list[_ngcontent-%COMP%]   .message-item.own-message[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]{color:#fffc}ion-footer[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #dee2e6}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;padding:0 8px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;--inner-padding-end: 0;--padding-start: 0;--min-height: auto}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;width:100%;padding:8px 0;gap:8px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;width:44px;height:44px;margin:0;background-color:transparent!important}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;color:red!important}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .input-container[_ngcontent-%COMP%]   ion-button.button-disabled[_ngcontent-%COMP%]{opacity:.5}.text-counter[_ngcontent-%COMP%]{font-size:12px;color:var(--timestamp-color);text-align:right;padding:4px 8px;opacity:.7}.character-limit-warning[_ngcontent-%COMP%]{color:#dc3545}@keyframes _ngcontent-%COMP%_messageAppear{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.message-item[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_messageAppear .3s ease-out}.message-content[_ngcontent-%COMP%]{max-width:100%;overflow-wrap:break-word}.message-content[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .message-content[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:100%;height:auto}.message-content[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-wrap;word-wrap:break-word;max-width:100%;overflow-x:auto}']}),g})()}];let w=(()=>{var o;class g{}return(o=g).\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.$C({type:o}),o.\u0275inj=n.G2t({imports:[l.MD,d.YN,i.bv,u.iI.forChild(v)]}),g})()}}]);