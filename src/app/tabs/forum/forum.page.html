
<ion-header class="ion-no-border">
  <div class="sticky top-0 z-10 bg-white  dark:bg-gray-900 shadow-sm ">
    <!-- Top Navigation Bar -->
    <div class="flex items-center justify-between py-2 px-4">
      <!-- Logo and Brand -->
      <div class="flex items-center">
        <img src="assets/logo-no-text.png" alt="BatStateU Logo" class="h-10 w-10" />
        <h1 class="text-xl font-bold text-red-700 dark:text-red-400 ml-2">
          BatStateU <span class="text-darkBackground dark:text-darkText">Connect+</span>
        </h1> 
      </div>
      
      <!-- Right Side Actions -->
      <div class="flex items-center space-x-3">
        <button class="p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300">
          <ion-icon name="search-outline" size="small"></ion-icon>
        </button>
        <button (click)="toggleDarkMode()" class="p-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300">
          <ion-icon name="moon-outline" size="small"></ion-icon>
        </button>

      </div>
    </div>
  </div>
</ion-header>


  <ion-content class="ion-no-padding ion-no-margin bg-transparent w-full">
    <div class="mx-auto bg-gray-100 w-full dark:bg-darkBackground px-4 space-y-4 pt-4 pb-4">
    
    
      <!-- Create Post Card -->
      
      <div class="bg-white dark:bg-gray-800  space-y-3 rounded-xl shadow-md p-4 flex flex-col items-center max-w-md mx-auto">
        <div class="flex items-center w-full">
          <!-- Avatar -->
          <ng-container *ngIf="userData; else loadingSkeleton">
            <img
              [src]="userData?.profilePictureUrl || './assets/profile-placeholder.jpg'"
              class="w-11 h-11 rounded-full object-cover border border-gray-200 dark:border-gray-700"
              alt="Profile Picture"
            />
            <div class="ml-3 flex-1">
              <span class="block font-semibold text-darkBackground dark:text-gray-100">{{ userData?.fullName || 'User' }}</span>
              <span class="block text-xs text-gray-500 dark:text-gray-400">{{ userData?.email }} • {{ userData?.role }}</span>
            </div>
          </ng-container>
          <!-- Skeleton Loader -->
          <ng-template #loadingSkeleton>
            <div class="w-11 h-11 rounded-full bg-gray-200 dark:bg-gray-700 animate-pulse"></div>
            <div class="ml-3 flex-1">
              <div class="h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded mb-2 animate-pulse"></div>
              <div class="h-3 w-24 bg-gray-200 dark:bg-gray-700 rounded animate-pulse"></div>
            </div>
          </ng-template>
        </div>
        
        <!-- Status Update Input -->
        <textarea
          [(ngModel)]="newPostContent"
          placeholder="What's on your mind?"
          maxlength="2800 "
          class="w-full mb-3 p-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-red-500 transition"
          style="resize: none; field-sizing: content; max-height: 112px;"
        ></textarea>
        <button
          (click)="fileInput.click()"
          class="w-full flex items-center justify-center py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg border border-dashed border-gray-300 dark:border-gray-600 transition"
        >
          <ion-icon name="images" class="text-lg text-green-500 mr-2"></ion-icon>
          <span class="text-sm text-gray-700 dark:text-gray-200">Upload Photo</span>
        </button>
        <input
          type="file"
          #fileInput
          accept="image/*"
          (change)="onImageSelected($event)"
          style="display: none;"
        />
        <div *ngIf="selectedImageUrl" class="w-full mt-4 relative">
          <img [src]="selectedImageUrl" alt="Selected" class="w-full rounded-lg object-cover max-h-80 border" />
          <button
            (click)="removeSelectedImage()"
            class="absolute top-2 right-2 bg-gray-800 bg-opacity-70 text-white rounded-full p-1"
          >
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>
        <button
          *ngIf="selectedImageUrl || newPostContent.trim()"
          (click)="createPost()"
          class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="isLoading || (!selectedImageUrl && !newPostContent.trim())"
        >
          {{ isLoading ? 'Posting...' : 'Post' }}
        </button>
      </div>
  
  
  
      <!-- Posts Feed -->
      <div class="max-w-md mx-auto space-y-4">
        <div *ngFor="let post of posts" class="bg-white dark:bg-gray-800 rounded-lg shadow-sm">
          <!-- Post Header -->
          <div class="p-4">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <img
                  [src]="post.authorAvatar || '/assets/default-avatar.png'"
                  class="w-10 h-10 rounded-full object-cover"
                  alt="Author Picture"
                />
                <div>
                  <div class="flex items-center">
                    <h3 class="font-semibold text-gray-800 dark:text-white">{{ post.authorName }}</h3>
                    <span *ngIf="post.authorRole" class="ml-2 px-2 py-0.5 bg-gray-100 dark:bg-gray-700 text-xs rounded-full text-gray-600 dark:text-gray-300">{{ post.authorRole }}</span>
                  </div>
                  <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                    <span>{{ convertTimestampToDate(post.timestamp) ? (convertTimestampToDate(post.timestamp) | date:'MMM d, y • h:mm a') : 'Date unavailable' }}</span>  
                  </div>
                </div>
              </div>
  
              <!-- Post Actions -->
              <div class="relative">
                <button
                  class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700"
                  (click)="toggleMenu(post.id)"
                  [attr.aria-expanded]="openedMenuPostId === post.id"
                  type="button"
                >
                  <ion-icon name="ellipsis-horizontal"></ion-icon>
                </button>
              
                <div
                  *ngIf="openedMenuPostId === post.id"
                  class="absolute right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg z-10 border border-gray-200 dark:border-gray-700"
                >
                  <button
                    (click)="deletePost(post); closeMenu()"
                    class="flex items-center space-x-2 w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700"
                  >
                    <ion-icon name="trash-outline"></ion-icon>
                    <span *ngIf="openedMenuPostId === post.id" >Delete post {{post.userId}} | {{userData?.uid}}</span>
                  </button>
                </div>
              </div>
              
              
        
            </div>
  
            <!-- Post Content -->
            <p class="mt-3 text-gray-800 dark:text-gray-200">{{ post.content }}</p>
          </div>
  
          <!-- Post Image -->
          <div *ngIf="post.imageUrl" class="mt-1">
            <img [src]="post.imageUrl" alt="Post Image" class="w-full max-h-[500px] object-contain bg-black" />
          </div>
  
          <!-- Engagement Stats -->
          <div class="px-4 py-2 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-700">
            <div class="flex items-center space-x-1">
              <div class="flex -space-x-1">
                <div class="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center">
                  <ion-icon name="thumbs-up" class="text-white text-xs"></ion-icon>
                </div>
                <div *ngIf="(post.dislikes?.length || 0) > 0" class="w-5 h-5 rounded-full bg-red-500 flex items-center justify-center">
                  <ion-icon name="thumbs-down" class="text-white text-xs"></ion-icon>
                </div>
              </div>
              <span>{{ (post.likes?.length || 0) + (post.dislikes?.length || 0) }}</span>
            </div>
            
            <div class="flex space-x-3">
              <span *ngIf="post.comments?.length">{{ post.comments?.length }} comments</span>
              <span>0 shares</span>
            </div>
          </div>
  
          <!-- Action Buttons -->
          <div class="flex items-center justify-around px-2 py-1">
            <button
              (click)="toggleLike(post)"
              class="flex items-center justify-center space-x-1 flex-1 py-2 text-sm font-medium rounded-md"
              [class.text-blue-600]="post.likes?.includes(userData?.uid)"
              [class.text-gray-600]="!post.likes?.includes(userData?.uid)"
              [class.dark:text-blue-400]="post.likes?.includes(userData?.uid)"
              [class.dark:text-gray-400]="!post.likes?.includes(userData?.uid)"
            >
              <ion-icon [name]="post.likes?.includes(userData?.uid) ? 'thumbs-up' : 'thumbs-up-outline'"></ion-icon>
              <span>Like</span>
            </button>

            <!-- <button
                (click)="toggleDislike(post)"
                class="flex items-center justify-center space-x-1 flex-1 py-2 text-sm font-medium rounded-md"
                [class.text-red-600]="post.dislikes?.includes(userData?.uid)"
                [class.text-gray-600]="!post.dislikes?.includes(userData?.uid)"
                [class.dark:text-red-400]="post.dislikes?.includes(userData?.uid)"
                [class.dark:text-gray-400]="!post.dislikes?.includes(userData?.uid)"
              >
                <ion-icon [name]="post.dislikes?.includes(userData?.uid) ? 'thumbs-down' : 'thumbs-down-outline'"></ion-icon>
                <span>Dislike</span>
              </button> -->

            
            <button
              (click)="openCommentModal(post.id)"
              class="flex items-center justify-center space-x-1 flex-1 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 rounded-md"
            >
              <ion-icon name="chatbubble-outline"></ion-icon>
              <span>Comment</span>
            </button>
            
            
          </div>
          
          <!-- Quick Comment Input -->
          <div class="px-4 py-2 flex items-center space-x-2 border-t border-gray-100 dark:border-gray-700">
            <img
              [src]="userData?.profilePictureUrl || './assets/profile-placeholder.jpg'"
              class="w-8 h-8 rounded-full object-cover"
              alt="Profile Picture"
            />
            <div 
              (click)="openCommentModal(post.id)"
              class="flex-1 bg-gray-100 dark:bg-gray-700 rounded-full py-1.5 px-3 text-gray-500 dark:text-gray-400 text-sm"
            >
              Write a comment...
            </div>
          </div>
        </div>
      </div>
      <div class="h-1 border border-gray-100"></div>
      
      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="flex justify-center py-6">
        <ion-spinner name="dots" class="text-red-600"></ion-spinner>
      </div>
    </div>
  </ion-content>
